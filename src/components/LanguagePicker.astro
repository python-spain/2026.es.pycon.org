---
import { i18n } from 'astro:config/client'
import { texts } from '../i18n/components/LanguagePicker'

// Idiomas disponibles
const languages = i18n.locales as string[]

interface Props {
  variant?: 'desktop' | 'mobile'
}

const { variant = 'desktop' } = Astro.props

// Idioma actual detectado desde la URL
const pathname = Astro.url.pathname
const currentLang = pathname.split('/')[1] || i18n.defaultLocale
const t = texts[currentLang as keyof typeof texts] || texts['es']

// FunciÃ³n para construir la URL destino
const getPathForLang = (targetLang: string) => {
  const parts = pathname.split('/').filter(Boolean)

  // Si ya hay idioma, lo reemplaza
  if (languages.some((l) => l === parts[0])) {
    parts[0] = targetLang
  } else {
    parts.unshift(targetLang)
  }

  return '/' + parts.join('/')
}
---

{
  variant === 'desktop' ? (
    <div
      class="lang-picker flex items-center gap-1 border-l border-white/20 pl-6 ml-2"
      role="group"
      aria-label={t['alttext']}
    >
      {languages.map((lang) => (
        <a
          href={getPathForLang(lang)}
          hreflang={lang}
          aria-label={t['labelariadesc'][lang]}
          lang={lang}
          aria-current={lang === currentLang ? 'page' : undefined}
          class:list={[
            'px-2 py-1 text-sm font-mono rounded transition-colors outline-none',
            lang === currentLang
              ? 'text-blue-400 font-bold'
              : 'text-slate-400 hover:text-white focus-visible:text-blue-400',
          ]}
        >
          {t.label[lang as keyof typeof t.label]}
        </a>
      ))}
    </div>
  ) : (
    <div class="lang-picker-mobile border-t border-white/10 pt-4 mt-2" role="group" aria-label={t['alttext']}>
      <span class="text-slate-500 text-sm font-medium mb-2 block">Idioma</span>
      <div class="flex gap-2">
        {languages.map((lang) => (
          <a
            href={getPathForLang(lang)}
            hreflang={lang}
            lang={lang}
            aria-current={lang === currentLang ? 'page' : undefined}
            aria-label={`${t['labelariadesc']} ${t.label[lang as keyof typeof t.label]}`}
            class:list={[
              'px-3 py-2 text-sm font-mono rounded transition-colors outline-none',
              lang === currentLang
                ? 'bg-blue-600 text-white font-bold'
                : 'bg-white/5 text-slate-300 hover:bg-white/10 focus-visible:bg-blue-600 focus-visible:text-white',
            ]}
          >
            {t.label[lang as keyof typeof t.label]}
          </a>
        ))}
      </div>
    </div>
  )
}
<style>
  /* Underline on hover/focus for language links */
  .lang-picker a:where(:hover, :focus-visible):not([aria-current='page']),
  .lang-picker-mobile a:where(:hover, :focus-visible):not([aria-current='page']) {
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 4px;
  }
</style>
