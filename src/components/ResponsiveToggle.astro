---
/**
 * ResponsiveToggle Component
 *
 * @description A toggle button for mobile navigation with full accessibility support
 * Based on accessible-astro-starter patterns
 */
interface Props {
  /**
   * Additional classes to apply to the ResponsiveToggle
   */
  class?: string
}

const { class: className } = Astro.props
---

<button
  class:list={[
    className,
    'responsive-toggle lg:hidden text-white p-2 rounded outline-none transition-colors focus-visible:bg-white/15 focus-visible:text-blue-300',
  ]}
  aria-expanded="false"
  aria-label="Abrir menú de navegación"
  aria-controls="mobile-menu"
>
  <span class="sr-only lg:not-sr-only mr-1">Menú</span>
  <svg
    class="w-8 h-8 transition-transform"
    width="26"
    height="21"
    aria-hidden="true"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M2 1.667h24m-24 8h24m-24 8h24"
      stroke="currentColor"
      stroke-width="2.667"
      stroke-linecap="round"
      stroke-linejoin="round"></path>
  </svg>
</button>

<script>
  document.addEventListener('astro:page-load', () => {
    // variables
    const responsiveToggle = document.querySelector('.responsive-toggle')
    if (!responsiveToggle) return

    // functions
    const openMenu = (toggle: Element): void => {
      const text = toggle.querySelector('span')
      const icon = toggle.querySelector('svg')
      if (!text || !icon) return

      text.textContent = 'Cerrar'
      toggle.setAttribute('aria-expanded', 'true')
      toggle.setAttribute('aria-label', 'Cerrar menú de navegación')
      icon.innerHTML = `<path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="2.667" stroke-linecap="round" stroke-linejoin="round"/>`
    }

    const closeMenu = (toggle: Element): void => {
      const text = toggle.querySelector('span')
      const icon = toggle.querySelector('svg')
      if (!text || !icon) return

      text.textContent = 'Menú'
      toggle.setAttribute('aria-expanded', 'false')
      toggle.setAttribute('aria-label', 'Abrir menú de navegación')
      icon.innerHTML = `<path d="M2 1.667h24m-24 8h24m-24 8h24" stroke="currentColor" stroke-width="2.667" stroke-linecap="round" stroke-linejoin="round"/>`
    }

    // execution
    responsiveToggle.addEventListener('click', () => {
      const mobileNavigation = document.querySelector('.mobile-menu')
      if (!mobileNavigation) return

      mobileNavigation.classList.toggle('show')
      mobileNavigation.classList.contains('show') ? openMenu(responsiveToggle) : closeMenu(responsiveToggle)
    })
  })
</script>

<style>
  .responsive-toggle {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    border: none;
    background: transparent;
    cursor: pointer;
  }

  .responsive-toggle:where(:hover, :focus-visible) span:not(.sr-only) {
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 4px;
  }

  /* Screen reader only class */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  @media (min-width: 1024px) {
    .responsive-toggle {
      display: none;
    }
  }
</style>
